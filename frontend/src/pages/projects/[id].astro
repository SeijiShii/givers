---
import BaseLayout from '../../layouts/BaseLayout.astro';
import ProjectDetail from '../../components/react/ProjectDetail';
import { t } from '../../lib/i18n';
import { SITE_URL } from '../../lib/site';

export const prerender = false;
const { id } = Astro.params;
const locale = 'ja';

let ogTitle: string | undefined;
let ogDescription: string | undefined;
let ogUrl: string | undefined;
if (id) {
  try {
    const API_URL = import.meta.env.PUBLIC_API_URL || 'http://localhost:8080';
    const res = await fetch(`${API_URL}/api/projects/${id}`);
    if (res.ok) {
      const project = await res.json();
      ogTitle = `${project.name} | GIVErS`;
      ogDescription = (project.description || '').substring(0, 120);
    }
  } catch { /* fallback to defaults */ }
  ogUrl = `${SITE_URL}/projects/${id}`;
}
---

<BaseLayout title={id ? `Project ${id}` : 'Project'} locale={locale} ogTitle={ogTitle} ogDescription={ogDescription} ogUrl={ogUrl} ogType="article">
  {id ? (
    <ProjectDetail
      client:load
      id={id}
      locale={locale}
      backLabel={t(locale, 'projects.backToList')}
      supportStatus={t(locale, 'projects.supportStatus')}
      supportTitle={t(locale, 'projects.supportTitle')}
      donateLabel={t(locale, 'projects.donate')}
      ownerLabel={t(locale, 'projects.owner')}
      recentSupportersLabel={t(locale, 'projects.recentSupporters')}
      anonymousLabel={t(locale, 'projects.anonymous')}
      donateFormPresets={[300, 500, 1000, 3000, 5000]}
      customAmountLabel={t(locale, 'projects.customAmount')}
      messageLabel={t(locale, 'projects.messageLabel')}
      messagePlaceholder={t(locale, 'projects.messagePlaceholder')}
      thankYouTitle={t(locale, 'projects.thankYouTitle')}
      donateLabelMonthly={t(locale, 'projects.donateMonthly')}
      oneTimeLabel={t(locale, 'projects.oneTime')}
      monthlyLabel={t(locale, 'projects.monthly')}
      donationTypeLabel={t(locale, 'projects.donationTypeLabel')}
      chartMinAmountLabel={t(locale, 'projects.chartMinAmount')}
      chartTargetAmountLabel={t(locale, 'projects.chartTargetAmount')}
      chartActualAmountLabel={t(locale, 'projects.chartActualAmount')}
      chartNoDataLabel={t(locale, 'projects.chartNoData')}
      hostPageLink={t(locale, 'platformProject.hostPageLink')}
      tabSupportLabel={t(locale, 'projects.tabSupport')}
      tabOverviewLabel={t(locale, 'projects.tabOverview')}
      tabUpdatesLabel={t(locale, 'projects.tabUpdates')}
      updatesEmptyLabel={t(locale, 'projects.updatesEmpty')}
      editOverviewLabel={t(locale, 'projects.editOverview')}
      saveLabel={t(locale, 'projects.save')}
      cancelLabel={t(locale, 'projects.cancel')}
      postUpdateLabel={t(locale, 'projects.postUpdate')}
      updateTitlePlaceholder={t(locale, 'projects.updateTitlePlaceholder')}
      updateBodyPlaceholder={t(locale, 'projects.updateBodyPlaceholder')}
      editUpdateLabel={t(locale, 'projects.editUpdate')}
      deleteUpdateLabel={t(locale, 'projects.deleteUpdate')}
      deleteUpdateConfirmTitle={t(locale, 'projects.deleteUpdateConfirmTitle')}
      deleteUpdateConfirmLabel={t(locale, 'projects.deleteUpdateConfirm')}
      hideUpdateLabel={t(locale, 'projects.hideUpdate')}
      hideUpdateConfirmTitle={t(locale, 'projects.hideUpdateConfirmTitle')}
      hideUpdateConfirmLabel={t(locale, 'projects.hideUpdateConfirm')}
      showUpdateLabel={t(locale, 'projects.showUpdate')}
      relatedProjectsLabel={t(locale, 'projects.relatedTitle')}
      watchLabel={t(locale, 'projects.watch')}
      unwatchLabel={t(locale, 'projects.unwatch')}
      shareUrl={`${SITE_URL}/projects/${id}`}
      shareLabel={t(locale, 'share.label')}
    />
  ) : (
    <p>Invalid project</p>
  )}
</BaseLayout>
