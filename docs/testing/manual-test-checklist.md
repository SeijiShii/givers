# 手動テストチェックリスト（Google OAuth 実環境）

## アカウント

| アカウント | 役割 | 備考 |
|-----------|------|------|
| **アカウント A** | 一般ユーザー → プロジェクトオーナー | |
| **アカウント B** | ホスト | `HOST_EMAILS` に登録 |

## 前提条件

```bash
# docker-compose up db  (PostgreSQL 起動)
# go run ./cmd/migrate   (マイグレーション)
# go run ./cmd/server    (バックエンド起動)
# cd frontend && npm run dev  (フロントエンド起動)
```

```env
# .env（バックエンド）
AUTH_REQUIRED=true
GOOGLE_CLIENT_ID=<設定済み>
GOOGLE_CLIENT_SECRET=<設定済み>
HOST_EMAILS=<アカウントBのGmailアドレス>
DATABASE_URL=postgres://givers:givers@localhost:5432/givers?sslmode=disable
SESSION_SECRET=<32文字以上のランダム文字列>

# frontend/.env
PUBLIC_MOCK_MODE=false
PUBLIC_API_URL=http://localhost:8080
```

---

## Phase 1: 公開ページ（未ログイン）

- [ ] `http://localhost:4321/` — ホーム表示
- [ ] `/projects` — プロジェクト一覧（まだ空 or 少数）
- [ ] `/faq` — FAQ 表示
- [ ] `/about` — About 表示
- [ ] `/terms` — 利用規約表示
- [ ] `/privacy` — プライバシーポリシー表示
- [ ] `/contact` — フォーム表示、メール + メッセージ入力 → 送信成功
- [ ] `/host` — プラットフォームページ表示

---

## Phase 2: 認証（アカウント A）

- [ ] ナビの「ログイン」ボタンクリック
- [ ] Google ログイン画面 → アカウント A でログイン
- [ ] `http://localhost:4321/` にリダイレクト → ナビにユーザー名表示
- [ ] `/me` — マイページ表示（空のプロジェクト・寄付一覧）
- [ ] ログアウトボタンクリック → ナビからユーザー名消滅
- [ ] 再度ログイン（セッションが新しく作成される確認）

---

## Phase 3: プロジェクト操作（アカウント A）

### 3-1. プロジェクト作成
- [ ] `/projects/new` へ移動
- [ ] プロジェクト名入力: `テストプロジェクト`
- [ ] 説明入力
- [ ] シェアメッセージ入力: `テストのシェアメッセージ`
- [ ] 金額タイプ: 「希望額」→ ¥10,000 入力
- [ ] 送信 → プロジェクトページ or Stripe Connect にリダイレクト
- [ ] プロジェクト一覧に新規プロジェクト表示確認

### 3-2. プロジェクト詳細確認
- [ ] 作成したプロジェクトの詳細ページ表示
- [ ] タイトル・説明・金額情報が正しい
- [ ] Support タブ: チャート・寄付フォーム表示

### 3-3. Overview 編集
- [ ] 「概要を編集」ボタン表示（オーナーのみ）
- [ ] クリック → Markdown textarea 表示
- [ ] テキスト入力: `## テスト見出し\nここは概要です`
- [ ] 保存 → Markdown がレンダリングされる（h2 タグ）

### 3-4. Update 投稿
- [ ] Updates タブ切替
- [ ] タイトル: `初回アップデート` + 本文入力
- [ ] 投稿 → 一覧に表示
- [ ] 編集ボタン → 内容変更 → 保存
- [ ] 非表示ボタン → 確認ダイアログ → OK → グレーアウト表示

### 3-5. プロジェクト編集
- [ ] `/projects/<id>/edit` へ移動
- [ ] フォームに既存値がプリフィル
- [ ] 説明変更 → 保存 → 詳細ページで反映確認

### 3-6. シェアボタン
- [ ] X / Facebook / LINE ボタン 3 つ表示
- [ ] X ボタンクリック → ダイアログ開く
- [ ] textarea に「テストのシェアメッセージ」（DB値）が入っている
- [ ] メッセージ編集 → 「投稿する」→ Twitter シェア画面オープン
- [ ] ページリロード → 再度 X クリック → 前回編集したメッセージが保持

---

## Phase 4: 寄付（アカウント B → アカウント A のプロジェクト）

- [ ] アカウント B で Google ログイン
- [ ] アカウント A のプロジェクト詳細を開く
- [ ] ¥500 プリセット選択 → 「ワンタイム」→ 寄付ボタン
- [ ] Stripe Checkout ページ表示（テストモード: カード 4242 4242 4242 4242）
- [ ] 支払い完了 → `?donated=1` リダイレクト → Thank you 表示
- [ ] `/me` → Donations タブに寄付履歴 1 件表示
- [ ] （オプション）月次 ¥1000 寄付 → 月次サブスクリプション作成確認

---

## Phase 5: ウォッチ（アカウント B）

- [ ] アカウント A のプロジェクト詳細で「ウォッチ」クリック
- [ ] ボタンが「ウォッチ中」に変化
- [ ] `/me` → Watches タブにプロジェクト表示
- [ ] 詳細ページに戻り「アンウォッチ」クリック → ボタンが「ウォッチ」に戻る
- [ ] `/me` → Watches タブからプロジェクト消滅

---

## Phase 6: ホスト管理（アカウント B）

### 6-1. ユーザー管理
- [ ] `/admin/users` — ユーザー一覧にアカウント A 表示
- [ ] 停止ボタンは動作確認のみ（実際に停止すると以降のテストに影響）

### 6-2. コンタクト管理
- [ ] `/host/contacts` — Phase 1 で送信したメッセージ表示
- [ ] 「既読にする」→ ステータス変更
- [ ] フィルター切替（全て / 未読 / 既読）

### 6-3. プロジェクト凍結（クロスユーザー）
- [ ] アカウント A のプロジェクト詳細を開く
- [ ] ステータスを「凍結」に変更（PATCH API or UI）
- [ ] 寄付フォームに凍結メッセージ表示
- [ ] ステータスを「アクティブ」に戻す

### 6-4. 開示データエクスポート
- [ ] `/admin/users` で開示エクスポートボタンクリック
- [ ] ダイアログ → ユーザー種別選択 → JSON ダウンロード
- [ ] ダウンロードした JSON にユーザー情報が含まれる

---

## Phase 7: ステータス変更（アカウント A）

- [ ] アカウント A でログイン
- [ ] `/me` → Projects タブ → ステータス dropdown →「frozen」
- [ ] プロジェクト詳細で寄付フォームに凍結メッセージ表示
- [ ] ステータスを「active」に戻す → 寄付フォーム復活

---

## Phase 8: 英語ロケール

- [ ] `/en` — 英語ホーム表示
- [ ] `/en/projects/<id>` — 英語プロジェクト詳細
- [ ] 言語切替リンク（日本語 ↔ English）の動作

---

## Phase 9: OGP 確認

```bash
# プロジェクト詳細の OGP
curl -s http://localhost:4321/projects/<id> | grep -o 'og:title.*"'
# → プロジェクト名が含まれる

# ホームの OGP
curl -s http://localhost:4321/ | grep -o 'og:description.*"'
# → 説明テキストが含まれる

# Twitter Card
curl -s http://localhost:4321/projects/<id> | grep 'twitter:card'
# → summary_large_image
```

---

## Phase 10: アクティビティ確認

- [ ] `/` — ホームの ActivityFeed にプロジェクト作成・寄付アクティビティ表示
- [ ] プロジェクト詳細の Activity も確認（あれば）

---

## 結果記録

| Phase | 結果 | メモ |
|-------|------|------|
| 1. 公開ページ | ☐ OK / ☐ NG | |
| 2. 認証 | ☐ OK / ☐ NG | |
| 3. プロジェクト操作 | ☐ OK / ☐ NG | |
| 4. 寄付 | ☐ OK / ☐ NG | |
| 5. ウォッチ | ☐ OK / ☐ NG | |
| 6. ホスト管理 | ☐ OK / ☐ NG | |
| 7. ステータス変更 | ☐ OK / ☐ NG | |
| 8. 英語ロケール | ☐ OK / ☐ NG | |
| 9. OGP | ☐ OK / ☐ NG | |
| 10. アクティビティ | ☐ OK / ☐ NG | |
